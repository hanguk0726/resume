---
import fs from 'node:fs/promises';
import TOML from '@iarna/toml';
import ProjectCard from '../components/ProjectCard.astro';

const tomlText = await fs.readFile('src/assets/projects.toml', 'utf-8');
const data = TOML.parse(tomlText);
const url = new URL(Astro.request.url);
const lang = url.searchParams.get('lang') || 'ko';
const toggleLang = lang === 'ko' ? 'en' : 'ko';
---

<html lang={lang}>
  <head>
    <meta charset="utf-8" />
    <title>Resume</title>
  </head>
  <body class="px-6">
    <header class="flex justify-between items-center mb-4">
      <div class="flex gap-4">
        <a href={`/?lang=${lang}`} class="text-sm text-gray-700 hover:underline">ðŸ’» Develop</a>
        <a href={`/about?lang=${lang}`} class="text-sm text-gray-700 hover:underline">ðŸ‘¤ About</a>
      </div>

      <a
        href={`${url.pathname}?lang=${toggleLang}`}
        class="text-sm text-blue-600 underline hover:text-blue-800"
        rel="external"
      >
        {toggleLang === 'ko' ? 'ðŸ‡°ðŸ‡· í•œêµ­ì–´ë¡œ ë³´ê¸°' : 'ðŸ‡ºðŸ‡¸ View in English'}
      </a>
    </header>

    <h1 class="text-2xl font-bold mb-4">Projects</h1>
    <div class="grid gap-4">
      {Object.values(data).map(project => (
        <ProjectCard project={project} lang={lang} />
      ))}
    </div>
  </body>
</html>
